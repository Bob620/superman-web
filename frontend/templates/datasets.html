{% extends "_common.html" %}
{% block head_matter %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.25.7/js/jquery.tablesorter.min.js"></script>
<script type="text/javascript">
function toggle_extra(elt) {
  $(elt).parents('tr.dataset').nextUntil('tr.dataset')
        .find('.hideme').slideToggle();
  return false;
}
$(document).ready(function() {
  $('#datasets').tablesorter();
})
</script>
<style type="text/css">
#datasets {
  margin: 1em auto;
  border-collapse: collapse;
  border: 1px solid black;
}
#datasets td {
  vertical-align: middle;
  background-color: #f7d3b2;
  border-right: 1px solid black;
  border-top: 1px solid black;
  text-align: center;
  padding: 6px;
  word-wrap: break-word;
}
#datasets tr.private td {
  background-color: #f78382;
}
#datasets td.ds_title {
  font-weight: bold;
  text-align: left;
}
#datasets td.ds_title form {
  float: right;
}
#datasets td.ds_title a {
  color: black;
}
#datasets td.numeric {
  text-align: right;
}
#datasets th {
  background-color: #6E9297;
  border: 1px solid black;
  text-align:center;
  font-weight:bold;
  padding: 0.5em;
  cursor: pointer;
}
#datasets tr.extra td {
  background-color: lightgray;
  text-align: left;
  width: 1px;  /* HACK: prevent extra row from resizing table width */
  padding: 0;
  border: none;
}
#datasets tr.extra .hideme {
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  border-top: 1px solid black;
}
#datasets tr.extra .explore_btn {
  -webkit-appearance: button;
  -moz-appearance: button;
  appearance: button;
  color: initial;
  text-decoration: none;
  text-align: center;
  margin: 0 0.5em;
  padding: 1em 0.5em;
  flex: 1 0 auto;
}
#datasets tr.extra .ds_info {
  padding: 0.25em 0;
}
#datasets tr.extra .ds_info .metadata {
  display: inline;
  list-style: none;
}
#datasets tr.extra .ds_info .metadata li {
  display: inline;
  white-space: nowrap;
}
#datasets tr.extra .ds_info .metadata li:after {
  content: ", ";
}
#datasets tr.extra .ds_info .metadata li:last-child:after {
  content: "";
}
</style>
{% end %}

{% block body_matter %}
<div>
<table class='tablesorter' id='datasets'>
  <caption>
    A listing of all available datasets.
    Click a heading to sort by that column.
  </caption>
  <thead><tr>
    <th>Dataset</th>
    <th>Type</th>
    <th># Spectra</th>
    <th># Channels</th>
    <th>Unique Keys?</th>
    <th>Last Updated</th>
  </tr></thead>
  <tbody>
{% for d in sorted(datasets, key=str) %}
  <tr class='dataset {%if not d.is_public %}private{%end%} tablesorter-hasChildRow'>
    <td class='ds_title'>
      <a href="#" onclick="return toggle_extra(this)">{{d.name}}</a>
      {%if d.user_added %}
      <form action='/_dataset_remover' method='POST'>
        <input type="hidden" name="name" value="{{d.name}}">
        <input type="hidden" name="kind" value="{{d.kind}}">
        <button type="submit" class='remove_row'>&times;</button>
      </form>
      {% end %}
    </td>
    <td>{{d.kind}}</td>
    <td class='numeric'>{{d.num_spectra()}}</td>
    {% if d.num_dimensions() is None %}
      <td>&mdash;</td>
    {% else %}
      <td class='numeric'>{{d.num_dimensions()}}</td>
    {% end %}
    {% if d.pkey is None %}
      <td>&#x2718;</td>
    {% else %}
      <td>&#x2714;</td>
    {% end %}
    <td>{{dt(int(d.load_time)).strftime("%Y-%m-%d %H:%M")}}</td>
  </tr>
  <tr class='extra tablesorter-childRow'><td colspan=6>
   <div class='hideme' style="display: none;">
    <a class='explore_btn'
 href="/explorer?ds_kind={{url_escape(d.kind)}}&ds_name={{url_escape(d.name)}}">
    Explore</a>
    <div class='ds_info'>
      <b>Metadata:</b>
      <ul class='metadata'>
      {% for name in sorted(m.display_name(k) for k,m in d.metadata.items()) %}
        <li>{{name}}</li>
      {% end %}
      </ul><br />
      <b>Description:</b> {{d.description}}<br />
      {% for url in d.urls %}
        <a href="{{url}}">{{url}}</a><br />
      {% end %}
    </div>
  </div></td></tr>
{% end %}
  </tbody>
</table>
</div>

{% end %}
