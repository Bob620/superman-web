{% extends "_common.html" %}
{% block head_matter %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.25.7/js/jquery.tablesorter.min.js"></script>
<script type="text/javascript">
function toggle_extra(elt) {
  $(elt).parents('tr.dataset').nextUntil('tr.dataset').toggle();
}
$(document).ready(function() {
  $('#datasets').tablesorter();
})
</script>
<style type="text/css">
#datasets {
  margin: 1em auto;
  border-collapse: collapse;
  border: 1px solid black;
}
#datasets td {
  vertical-align: middle;
  background-color: #f7d3b2;
  border: 1px solid black;
  text-align: center;
  padding: 6px;
  word-wrap: break-word;
}
#datasets tr.private td {
  background-color: #f78382;
}
#datasets td.ds_title {
  font-weight: bold;
  text-align: left;
}
#datasets td.ds_title a {
  color: black;
}
#datasets td.numeric {
  text-align: right;
}
#datasets th {
  background-color: #6E9297;
  border: 1px solid black;
  text-align:center;
  font-weight:bold;
  padding: 0.5em;
  cursor: pointer;
}
#datasets tr.extra {
  display: none;
}
#datasets tr.extra td {
  background-color: lightgray;
  text-align: left;
  width: 1px;  /* HACK: prevent extra row from resizing table width */
}
#datasets tr.extra .aligned {
  padding-left: 4em;
  text-indent: -2em;
}
#datasets tr.extra .metadata {
  display: inline;
  list-style: none;
}
#datasets tr.extra .metadata li {
  display: inline;
  white-space: nowrap;
}
#datasets tr.extra .metadata li:after {
  content: ", ";
}
#datasets tr.extra .metadata li:last-child:after {
  content: "";
}
</style>
{% end %}

{% block body_matter %}
<div>
<table class='tablesorter' id='datasets'>
  <caption>
    A listing of all available datasets.
    Click a heading to sort by that column.
  </caption>
  <thead><tr>
    <th>Dataset</th>
    <th>Type</th>
    <th># Spectra</th>
    <th># Channels</th>
    <th>Unique Keys?</th>
    <th>Last Updated</th>
  </tr></thead>
  <tbody>
{% for d in sorted(datasets, key=str) %}
  <tr class='dataset {%if not d.is_public %}private{%end%} tablesorter-hasChildRow'>
    <td class='ds_title'>
      <a href="#" onclick="toggle_extra(this)">{{d.name}}</a>
    </td>
    <td>{{d.kind}}</td>
    <td class='numeric'>{{d.num_spectra()}}</td>
    {% if d.num_dimensions() is None %}
      <td>&mdash;</td>
    {% else %}
      <td class='numeric'>{{d.num_dimensions()}}</td>
    {% end %}
    {% if d.pkey is None %}
      <td>&#x2718;</td>
    {% else %}
      <td>&#x2714;</td>
    {% end %}
    <td>{{dt(int(d.load_time)).strftime("%Y-%m-%d %H:%M")}}</td>
  </tr>
  <tr class='extra tablesorter-childRow'><td colspan=6>
    <div class='aligned'><b>Metadata:</b>
    <ul class='metadata'>
    {% for name in sorted(m.display_name(k) for k,m in d.metadata.items()) %}
      <li>{{name}}</li>
    {% end %}
    </ul></div>
    <div class='aligned'><b>Description:</b>
      {{d.description}}
    </div>
    <div class='aligned'>
    <a href="/explorer?ds_kind={{url_escape(d.kind)}}&ds_name={{url_escape(d.name)}}">
    Open in Dataset Explorer</a></div>
  </td></tr>
{% end %}
  </tbody>
</table>
</div>

{% end %}
